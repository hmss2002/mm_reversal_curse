# ==============================================================================
# Qwen3-VL-32B QLoRA训练配置 (V100 32GB 8卡数据并行 - 优化版)
# ==============================================================================

experiment:
  name: "reversal_curse_v3"
  seed: 42

model:
  name_or_path: "/work/models/qwen/Qwen3-VL-32B-Instruct"

lora:
  r: 4                            # Rank 4！节省约0.5GB
  alpha: 8                        # Alpha = 2 * r
  dropout: 0.05
  target_modules:
    - "q_proj"
    - "k_proj"
    - "v_proj"
    - "o_proj"

data:
  output_dir: "data/current_dataset"

training:
  # === Learning Rate ===
  learning_rate: 2e-4             # rank变小，lr要稍微提高
  min_lr: 2e-5
  lr_reduction_factor: 0.5
  lr_patience: 1
  improvement_threshold: 0.05
  min_val_loss: 0.2
  
  # === Batch Configuration ===
  batch_size: 1
  gradient_accumulation_steps: 1
  num_epochs: 3
  max_length: 256                  # 短序列
  warmup_ratio: 0.02
  weight_decay: 0.01
  
  # === 图像分辨率 ===
  max_pixels: 200704               # 448×448
  min_pixels: 65536                # 256×256
  
  # === 8-bit优化器（节省约2GB）===
  use_8bit_optimizer: true
  
  # === 输出目录 ===
  output_dir: "outputs"
